# 文件下载器

## 项目介绍

文件下载器是一款轻量级服务器应用，专注于简化远程文件下载管理。支持HTTP/HTTPS直链批量下载、实时进度跟踪（含速度/预计完成时间/总大小）、下载历史永久存储及文件全生命周期管理（下载-查看-删除）。适用于需要集中管理多文件下载的服务器场景，帮助用户高效追踪下载状态并快速获取历史记录。

**请注意！旨在解决用户在下载国外文件时常遇到的卡顿、速度慢和连接不稳定等问题。**

## 核心功能

- **多文件批量下载**：支持每行一个URL的批量输入，自动过滤无效链接。
- **智能文件名生成**：自动生成唯一文件名，避免重复下载时的文件覆盖。
- **实时进度监控**：提供下载百分比、速度（MB/s）、预计完成时间（秒）、总文件大小（MB）等多维数据。
- **历史记录管理**：永久存储下载记录（含文件名、大小、状态、时间），支持查看/删除（同步删除服务器文件）。
- **异常处理机制**：支持下载失败/取消状态标记，提供明确错误提示。
- **跨端适配**：前端基于HTML/CSS/JavaScript开发，兼容桌面及移动端。

## 使用方法

### 前端操作指南

1. **输入下载链接**：在文本框中粘贴文件直链（支持多行批量输入，每行一个URL），格式需以 `http://` 或 `https://` 开头。
2. **启动下载**：点击"开始"按钮，系统自动验证链接有效性并启动下载任务。
3. **查看实时进度**：在"当前任务"区域查看每个任务的下载进度（百分比/速度/预计完成时间/总大小），支持取消未完成任务（删除临时文件）。
4. **管理历史记录**：下载完成后，记录自动同步至"下载记录"列表，可：
   - 点击"下载到本地"将服务器文件保存至本地；
   - 点击"删除文件"删除记录并同步删除服务器文件（仅完成状态文件）。

### 后端API接口

| 接口类型 | 路径                     | 功能描述                         | 参数/说明                                                    |
| -------- | ------------------------ | -------------------------------- | ------------------------------------------------------------ |
| POST     | /download                | 启动下载任务                     | 需传递 `url` （文件直链）                                    |
| GET      | /progress/:taskId        | 查询指定任务进度                 | 返回 `percent` （百分比）、`speed`（速度）等                 |
| GET      | /history                 | 获取所有下载历史                 | 返回包含 `filename` （文件名）、`status` （状态）等字段的列表 |
| GET      | /download-file/:filename | 下载服务器文件到本地             | 若文件不存在返回404错误                                      |
| DELETE   | /delete-record/:taskId   | 删除记录及服务器文件（完成状态） | 需传递 `taskId` （任务唯一ID）                               |
| DELETE   | /cancel-download/:taskId | 取消未完成下载（删除临时文件）   | 需传递 `taskId` （任务唯一ID）                               |

## 启动流程

### 环境要求

- Node.js ≥18.x（推荐LTS版本）
- 操作系统：Linux/macOS/Windows

### 安装与运行

1. **克隆项目**（若未本地存储）：`git clone <项目仓库地址>`（替换为实际仓库URL）
2. **安装依赖**：进入项目根目录，执行 `npm install` 安装所需依赖（axios/fs-extra/uuid等）。
3. **启动服务**：执行 `node server.js` 启动服务，默认监听端口3000（可通过修改 `server.js` 中的 `PORT` 常量调整）。
4. **访问前端**：浏览器访问 `http://服务器IP:3000` 或 `http://localhost:3000` 即可使用。

### 初始化目录

首次启动会自动创建以下目录/文件：

- `downloads/`：存储最终下载完成的文件。
- `temp/`：存储下载过程中的临时文件（任务取消或失败时自动清理）。
- `history.json`：存储下载历史记录（含任务ID、文件名、状态等信息）。

## 注意事项

1. **文件存储安全**：下载完成的文件默认存储在 `downloads/` 目录，需确保服务器有足够存储空间；临时文件存储在 `temp/` ，无需手动清理。
2. **唯一文件名**：重复下载同一文件时，系统会自动在文件名后添加 `(n)` （如 `file(1).zip` ），避免覆盖。
3. **任务取消**：取消未完成任务会删除临时文件，但不影响已完成的历史记录；取消后需重新启动下载。
4. **历史记录删除**：删除记录时，若文件状态为"下载完成"，会同步删除服务器中的文件；其他状态仅删除记录。
5. **跨域配置**：开发阶段默认允许所有源跨域，生产环境需修改 `server.js` 中的 `cors` 配置，仅允许指定前端域名。

## 常见问题

### Q1：下载速度慢怎么办？

A：下载速度受服务器带宽、源文件所在服务器响应速度影响。建议：

- 检查服务器网络带宽是否充足；
- 尝试更换文件源（如从GitHub切换至官方CDN）；
- 批量下载时避免同时启动过多任务（建议≤5个并行）。

### Q2：文件重复下载会覆盖吗？

A：不会。系统会自动生成唯一文件名（如原文件为 `image.jpg` ，重复下载会生成 `image(1).jpg` ），确保历史文件完整保留。

### Q3：如何修改服务端口？

A：编辑 `server.js` 文件中的 `PORT` 常量（默认3000），修改后重启服务生效。例如：

```js
// server.js
const PORT = 8080; // 修改为8080端口
```

### Q4：历史记录丢失了怎么办？

A：历史记录存储在 `history.json` 文件中，若文件被误删，系统会在下次启动时自动创建空文件，但已删除的记录无法恢复。建议定期备份 `history.json` 。

### Q5：下载失败如何排查？

A：下载失败可能由以下原因导致：

- 输入的URL无效或文件已被删除；
- 源服务器限制了下载请求（如403禁止访问）；
- 服务器网络中断或存储空间不足。 可通过前端提示或后端日志（`node server.js` 输出）查看具体错误信息。